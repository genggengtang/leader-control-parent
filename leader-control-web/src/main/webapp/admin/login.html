<!--login_page_identity-->
<!--以上文件注释不可去掉，校验文件首页用,详见base.js的jquery.fn.load-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="baidu_union_verify" content="804240c1607916fb8a8b98c6bcd2cfdb">
    <meta name="keywords" content="AdminLTE,AdminEAP,AdminLTE框架">
    <meta name="description" content="基于AdminLTE的快速开发框架,让web开发更简单"> -->
    <!-- <meta property="wb:webmaster" content="4f7a2b4a630250fe" /> -->
    <title>精细化管理系统后台 | 登录</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!--icon-->
    <link rel="shortcut icon" type="image/x-icon" href="http://www.admineap.com/resources/common/favicon.ico" media="screen"/>
    <!-- Bootstrap 3.3.6 -->
    <!-- <link rel="stylesheet" href="https://adminlte.io/themes/AdminLTE/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://adminlte.io/themes/AdminLTE/bower_components/font-awesome/css/font-awesome.min.css"> -->
    
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/ionicons.min.css">
    <!-- Theme style -->
    <!-- <link rel="stylesheet" href="https://adminlte.io/themes/AdminLTE/dist/css/AdminLTE.min.css"> -->
    <link rel="stylesheet" href="css/AdminLTE.min.css">
    <!-- iCheck -->
    <!-- <link rel="stylesheet" href="http://www.admineap.com/resources/adminlte/plugins/iCheck/square/red.css"> -->
    
    <link rel="stylesheet" href="css/blue.css">
    <link rel="stylesheet" href="css/bootstrap-validator.css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/resources/common/libs/html5shiv/html5shiv.min.js"></script>
    <script src="/resources/common/libs/respond/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition login-page">
<div class="login-box">
    <div class="login-logo">
       <h3>精细化管理系统 | 后台登录</h3>
    </div>
    <!-- /.login-logo -->
    <div class="login-box-body">
        <!-- <p class="login-box-msg">测试账号test/bill</p> -->

        <form action="admin-login" method="post" id="login-form">
            <div class="form-group has-feedback">
                <input type="text" class="form-control" name="username" placeholder="请输入登录名">
                <!-- <span class="glyphicon glyphicon-envelope form-control-feedback"></span> -->
            </div>
            <div class="form-group has-feedback">
                <input type="password" class="form-control" name="passwd" id="passwd" placeholder="请输入密码">
                <input type="hidden" id="password" name="password"/>
                <!-- <span class="glyphicon glyphicon-lock form-control-feedback"></span> -->
            </div>
            <div class="form-group">
                <!-- <div class="col-xs-4" style="padding:0px;">
                    <input type="text" class="form-control" name="captcha" placeholder="请输入验证码">
                </div>
                <div class="col-xs-5" style="text-align:right;padding-right: 0px;">
                    <img id="codeImg" src="http://www.admineap.com/captcha" onclick="changeCaptcha()" class="img-responsive"
                         style="height: 35px;">
                    <input type="hidden" id="captchaValue"/>
                </div>
                <div class="col-xs-3" style="padding-top:10px;">
                    <span><a href="#" onclick="changeCaptcha()">换一换</a></span>
                </div> -->
                
                <div class="form-group" >
	                <div class="col-xs-6" style="padding:0px;">
	                	<input type="text" id="yzm" class="form-control" name="captcha" placeholder="验证码" required="required">
	                </div>
		            <div class="col-xs-3" style="text-align:right;padding-right: 0px;">
	                    <input style="font-family: Arial;font-style: italic; font-weight: bold;
		                border: 0; color: blue;height: 35px;" id="yzcode" type="button" onclick="createCode()" class="img-responsive">
	                </div>
	                 <div class="col-xs-3" style="padding-top:10px;">
	                    <span><a href="#" onclick="createCode()">换一换</a></span>
	                </div>
	            </div>
            </div>
            <div class="row" style="margin-top:70px;">
                <!-- <div class="col-xs-6">
                    <div class="checkbox icheck">
                        <label>
                            <input type="checkbox" name="rememberMe"> 记住用户
                        </label>
                    </div>
                </div> -->
                <!-- /.col -->
                <!-- <div class="col-xs-6">
                    <div class="checkbox pull-right">
                        <a href="#">忘记密码</a>
                        <span>&nbsp;/&nbsp;</span>
                        <a href="/register" class="text-center">注册</a>
                    </div>
                </div> -->
                <!-- /.col -->
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <button type="submit" class="btn btn-danger btn-block btn-flat">登 录</button>
                </div>
            </div>
        </form>
	</div>
</div>

<!-- jQuery 2.2.3 -->
<script src="https://adminlte.io/themes/AdminLTE/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="https://adminlte.io/themes/AdminLTE/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- iCheck -->
<script src="https://adminlte.io/themes/AdminLTE/plugins/iCheck/icheck.min.js"></script>
<!-- bootstrap-validator-->
<script src="http://www.admineap.com/resources/adminlte/plugins/bootstrap-validator/dist/js/bootstrap-validator.min.js"></script>
<!--login.js-->
<script src="js/login.js"></script>
<script src="//qiniu.jyblue.com/js/md5.js"></script>
<script src="//qiniu.jyblue.com/jquery.form.js"></script>
<script src="//qiniu.jyblue.com/checkCode.js"></script>

<script>
	String.prototype.trim=function(){
	    return this.replace(/(^\s*)|(\s*$)/g, "");
	}
	
	String.prototype.startWith=function(str){  
	    if(str==null||str==""||this.length==0||str.length>this.length)  
	      return false;  
	    if(this.substr(0,str.length)==str)  
	      return true;  
	    else  
	      return false;  
	    return true;  
	}
	
    $(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_square-red',
            radioClass: 'iradio_square-red',
            increaseArea: '20%' // optional
        });

        fillbackLoginForm();
        $("#login-form").bootstrapValidator({
            message: '请输入用户名/密码',
            submitHandler: function (valiadtor, loginForm, submitButton) {
                
                // valiadtor.defaultSubmit();
                if($("#login-form").data("bootstrapValidator").isValid()){
                	if(!validate()){
                		return false;
                	}
                
                	rememberMe($("input[name='rememberMe']").is(":checked"));

                	var tmp = hex_md5($("#passwd").val());
                    $("#password").val(tmp);  
                    $("#login-form").ajaxSubmit({  
                        success: function(data) { // data 保存提交后返回的数据，一般为 json 数据 
                        	console.log(data);
                            if(data.errorCode == 0)  {  
                               window.location.href = "auth/main";  
                            }   
                            else {
                               alert(data.errorMsg);                       
                            } 
                        }  
                    });
                }
            },
            fields: {
                username: {
                    validators: {
                        notEmpty: {
                            message: '登录用户名不能为空'
                        }
                    }
                },
                passwd: {
                    validators: {
                        notEmpty: {
                            message: '密码不能为空'
                        }
                    }
                },
                captcha:{
                    validators: {
                        notEmpty: {
                            message: '验证码不能为空'
                        }
                    }
                }
            }
        });
	
    });
    

    /* function changeCaptcha() {
        var cValue = Math.floor(Math.random() * 100);
    	$("#codeImg").attr("src", "http://www.admineap.com/captcha?random=" + Math.floor(Math.random() * 100));
    	$("#captchaValue").val(cValue);
    } */

    //使用本地缓存记住用户名密码
    function rememberMe(rm_flag) {
        //remember me
        if (rm_flag) {
            localStorage.username = $("input[name='username']").val();
            localStorage.passwd = $("input[name='passwd']").val();
            localStorage.rememberMe = 1;
        }
        //delete remember msg
        else {
            localStorage.username = null;
            localStorage.passwd = null;
            localStorage.rememberMe = 0;
        }
    }

    //记住回填
    function fillbackLoginForm() {
        if (localStorage.rememberMe && localStorage.rememberMe == "1") {
            $("input[name='username']").val(localStorage.username);
            $("input[name='passwd']").val(localStorage.passwd);
            $("input[name='rememberMe']").iCheck('check');
            $("input[name='rememberMe']").iCheck('update');
        }
    }
</script>
</body>
</html>
